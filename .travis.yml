# Use Ubuntu 14.04 on Travis, which makes it possible to use gcc 4.8.
sudo: required
dist: trusty

# Because there's no Julia by default on the Travis Trusty beta, we have to install it.
before_install:
  - sudo add-apt-repository ppa:staticfloat/juliareleases -y
  - sudo apt-get update -q
  - sudo apt-get install gcc-4.8 -y
  - sudo apt-get install julia

script:
  - if [[ -a .git/shallow ]]; then git fetch --unshallow; fi
  # Pull in and build CompilerTools dependency.
  - julia -e 'Pkg.clone("https://psl-travis-user:6mnZDX4Hf04Kcn1S2gog@github.com/IntelLabs/CompilerTools.jl.git")'
  - julia -e 'Pkg.build("CompilerTools")'
  # Build and test ParallelAccelerator.
  - julia -e 'Pkg.clone(pwd()); Pkg.build("ParallelAccelerator"); Pkg.test("ParallelAccelerator")'
  # Run examples.
  - julia examples/black-scholes/black-scholes.jl
  - julia examples/gaussian-blur/gaussian-blur.jl
  - julia examples/harris/harris.jl
  - julia examples/laplace-3d/laplace-3d.jl
